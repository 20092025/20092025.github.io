<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­å­¦ä¹ æ¯æ—¥æ™ºèƒ½å¥–åŠ±æ¸…å• - æ•°æ®ç®¡ç†ç‰ˆ</title>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“š</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <style>
        :root {
            --primary-color: #4b6cb7;
            --secondary-color: #182848;
            --accent-color: #28a745;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-dark: #333333;
            --text-light: #6c757d;
            --sync-color: #d4d4aa; /* åŒæ­¥æŒ‰é’®é¢œè‰²è°ƒæš— */
            --danger-color: #dc3545;
            --countdown-color: #ff6b35; /* å€’è®¡æ—¶é¢œè‰²æ›´é†’ç›® */
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            padding-top: calc(20px + var(--safe-area-inset-top));
            padding-bottom: calc(20px + var(--safe-area-inset-bottom));
            background-color: var(--light-bg);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            position: relative;
        }
        
        .sync-status {
            position: absolute;
            top: 15px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sync-icon {
            animation: spin 2s linear infinite;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .countdown {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 16px; /* å¢å¤§å­—ä½“ */
            font-weight: bold; /* åŠ ç²— */
            backdrop-filter: blur(5px);
            color: var(--countdown-color); /* ä½¿ç”¨é†’ç›®é¢œè‰² */
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            animation: pulse 2s infinite; /* æ·»åŠ è„‰åŠ¨åŠ¨ç”» */
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .nav-tabs {
            display: flex;
            margin-bottom: 20px;
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            -webkit-overflow-scrolling: touch;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            min-width: 120px;
        }
        
        .nav-tab.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: 600;
            background-color: rgba(75, 108, 183, 0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .progress-container {
            text-align: center;
        }
        
        .progress-bar {
            height: 28px;
            background-color: #e9ecef;
            border-radius: 6px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border-radius: 6px;
            transition: width 0.7s ease;
            width: 0%;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: var(--card-bg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            word-break: break-word;
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background-color: rgba(75, 108, 183, 0.05);
        }
        
        .points {
            font-weight: bold;
            color: var(--accent-color);
            text-align: center;
        }
        
        .category {
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .checkbox {
            width: 28px;
            height: 28px;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 4px;
            display: inline-block;
            position: relative;
            margin: 0;
            vertical-align: middle;
        }
        
        .checkbox:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .checkbox:checked::after {
            content: "âœ“";
            position: absolute;
            color: white;
            font-size: 18px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .data-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .btn {
            padding: 14px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            touch-action: manipulation;
            min-height: 44px;
        }
        
        .btn:hover, .btn:active {
            background-color: var(--secondary-color);
        }
        
        .btn-sync {
            background-color: var(--sync-color);
            color: #333;
        }
        
        .btn-sync:hover {
            background-color: #c0c090;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-danger:hover {
            background-color: #bb2d3b;
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 14px;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }
        
        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--accent-color);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        .sync-settings {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .data-records {
            margin-top: 30px;
        }
        
        .record-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .search-filter {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .search-filter input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ç§»åŠ¨è®¾å¤‡ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 15px;
                padding-top: calc(15px + var(--safe-area-inset-top));
                padding-bottom: calc(15px + var(--safe-area-inset-bottom));
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .countdown, .sync-status {
                position: static;
                margin-top: 10px;
                display: inline-block;
            }
            
            .data-form {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: row;
                overflow-x: auto;
            }
            
            .nav-tab {
                min-width: 100px;
                padding: 12px 10px;
                font-size: 14px;
            }
            
            table {
                font-size: 14px;
            }
            
            th, td {
                padding: 12px 8px;
            }
            
            .btn {
                padding: 12px 20px;
                width: 100%;
            }
            
            .card {
                padding: 15px;
            }
            
            .record-actions {
                flex-direction: column;
            }
            
            .btn-small {
                width: 100%;
            }
        }
        
        /* å¹³æ¿è®¾å¤‡ä¼˜åŒ– */
        @media (min-width: 769px) and (max-width: 1024px) {
            body {
                padding: 20px;
            }
            
            .nav-tab {
                min-width: 110px;
                padding: 14px 10px;
            }
        }
        
        /* é˜²æ­¢iOSç¼©æ”¾ */
        input, select, textarea {
            font-size: 16px !important;
        }
        
        /* é˜²æ­¢iOSç‚¹å‡»é«˜å…‰ */
        * {
            -webkit-tap-highlight-color: transparent;
        }

        /* ç»Ÿè®¡æ ‡ç­¾é¡µæ ·å¼ */
        .stats-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .stats-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
        }
        
        .stats-tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .stats-content {
            display: none;
        }
        
        .stats-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .stats-summary {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .stat-chart {
            height: 200px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .chart-bar {
            width: 30px;
            background-color: var(--primary-color);
            margin: 0 5px;
            border-radius: 4px 4px 0 0;
            position: relative;
            min-height: 10px;
        }
        
        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>è‹±è¯­å­¦ä¹ æ™ºèƒ½å¥–åŠ±ç³»ç»Ÿ</h1>
        <p>åŸºäºå¼ºåŒ–å­¦ä¹ æ–¹æ³•çš„84æ—¥CET-4åˆ°CET-6æå‡è®¡åˆ’</p>
        <div class="sync-status">
            <span class="sync-icon">ğŸ”„</span>
            <span id="sync-status-text">æœªåŒæ­¥</span>
        </div>
        <div class="countdown" id="exam-countdown">
            è·ç¦»è€ƒè¯•è¿˜æœ‰: <span id="countdown-days" style="font-size: 18px;">--</span> å¤©
        </div>
        <div class="date-selector">
            <label for="date">æ—¥æœŸ: </label>
            <input type="date" id="date" name="date">
            <button class="btn" onclick="updateDate()" style="padding: 10px 15px; margin-left: 10px;">æ›´æ–°</button>
            <button class="btn btn-sync" onclick="syncData()" style="padding: 10px 15px; margin-left: 10px;">åŒæ­¥æ•°æ®</button>
        </div>
    </div>

    <div class="nav-tabs">
        <div class="nav-tab active" onclick="switchTab('daily-tab')">æ¯æ—¥ä»»åŠ¡</div>
        <div class="nav-tab" onclick="switchTab('data-tab')">å­¦ä¹ æ•°æ®</div>
        <div class="nav-tab" onclick="switchTab('stats-tab')">æ•°æ®ç»Ÿè®¡</div>
        <div class="nav-tab" onclick="switchTab('rewards-tab')">å¥–åŠ±å…‘æ¢</div>
        <div class="nav-tab" onclick="switchTab('sync-tab')">åŒæ­¥è®¾ç½®</div>
    </div>

    <div id="daily-tab" class="tab-content active">
        <div class="card progress-container">
            <h3>ä»Šæ—¥è¿›åº¦ <span id="current-points">0</span>/100 åˆ†</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
                <div class="progress-text" id="progress-text">0%</div>
            </div>
            <p>ç›®æ ‡: â‰¥80åˆ†å¯è·å¾—30åˆ†é’Ÿæ— è´Ÿç½ªæ„Ÿå¨±ä¹æ—¶é—´</p>
        </div>

        <div class="card">
            <h3>æ¯æ—¥æ ¸å¿ƒä»»åŠ¡</h3>
            <table>
                <thead>
                    <tr>
                        <th width="8%">å®Œæˆ</th>
                        <th width="15%">ç±»åˆ«</th>
                        <th width="32%">è¡ŒåŠ¨ (Action)</th>
                        <th width="25%">ä¼˜åŒ–ä¸é˜²ä½œå¼Šæœºåˆ¶</th>
                        <th width="10%">å¥–åŠ±</th>
                        <th width="10%">å¾—åˆ†</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="checkbox" class="checkbox" id="task1" onclick="updatePoints(15, this)"></td>
                        <td class="category">è¯æ±‡æ”»åš</td>
                        <td>å­¦ä¹ å¹¶æŒæ¡35ä¸ªæ–°å…­çº§è¯æ±‡/çŸ­è¯­</td>
                        <td>å¿…é¡»èƒ½æ­£ç¡®æ‹¼å†™ã€è¯´å‡ºä¸­æ–‡æ„æ€ã€å¹¶é€ ä¸€ä¸ªæ­£ç¡®å¥å­ã€‚æ¬¡æ—¥å¤ä¹ æ—¶èƒ½å†æ¬¡è®¤å‡ºæ‰ç®—æ•°ã€‚</td>
                        <td class="points">+15</td>
                        <td id="point1">0</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" class="checkbox" id="task2" onclick="updatePoints(20, this)"></td>
                        <td class="category">å¬åŠ›æ²‰æµ¸</td>
                        <td>å®Œæˆ1ç¯‡å…­çº§å¬åŠ›çœŸé¢˜å¹¶ç²¾å¬å¤ç›˜</td>
                        <td>å¬å†™å‡ºé”™é¢˜ç‚¹çš„å…³é”®å¥ï¼Œå¹¶è·Ÿè¯»è‡³è¯­éŸ³è¯­è°ƒåŸºæœ¬ä¸€è‡´ã€‚</td>
                        <td class="points">+20</td>
                        <td id="point2">0</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" class="checkbox" id="task3" onclick="updatePoints(25, this)"></td>
                        <td class="category">é˜…è¯»è§£æ</td>
                        <td>å®Œæˆ2ç¯‡å…­çº§é˜…è¯»çœŸé¢˜å¹¶ç²¾è¯»åˆ†æ</td>
                        <td>æ‘˜å½•2ä¸ªé•¿éš¾å¥è¿›è¡Œç»“æ„åˆ†æï¼Œå¹¶æ•´ç†10ä¸ªç”Ÿè¯/çŸ­è¯­ã€‚</td>
                        <td class="points">+25</td>
                        <td id="point3">0</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" class="checkbox" id="task4" onclick="updatePoints(20, this)"></td>
                        <td class="category">å†™ä½œ/ç¿»è¯‘</td>
                        <td>å®Œæˆ1ç¯‡ä½œæ–‡æˆ–2æ®µç¿»è¯‘ç»ƒä¹ </td>
                        <td>å¿…é¡»ä½¿ç”¨è‡³å°‘5ä¸ªæœ¬æ—¥æˆ–æœ¬å‘¨å­¦ä¹ çš„æ–°è¯æ±‡æˆ–é«˜çº§å¥å‹ã€‚</td>
                        <td class="points">+20</td>
                        <td id="point4">0</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" class="checkbox" id="task5" onclick="updatePoints(20, this)"></td>
                        <td class="category">ç»¼åˆæŠ•å…¥</td>
                        <td>æ¯æ—¥é«˜æ•ˆå­¦ä¹ æ—¶é•¿ â‰¥ 2.5å°æ—¶</td>
                        <td>ä½¿ç”¨ç•ªèŒ„é’Ÿè®°å½•ï¼Œå¿ƒä¸åœ¨ç„‰çš„æ—¶é—´ä¸è®¡å…¥ã€‚</td>
                        <td class="points">+20</td>
                        <td id="point5">0</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h3>å¤–éƒ¨éªŒè¯ä»»åŠ¡ (æ¯å‘¨è‡³å°‘å®Œæˆ3é¡¹)</h3>
            <table>
                <thead>
                    <tr>
                        <th width="8%">å®Œæˆ</th>
                        <th width="15%">ç±»åˆ«</th>
                        <th width="37%">è¡ŒåŠ¨ (Action)</th>
                        <th width="20%">è¯´æ˜</th>
                        <th width="10%">å¥–åŠ±</th>
                        <th width="10%">å¾—åˆ†</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="checkbox" class="checkbox" id="task6" onclick="updatePoints(15, this)"></td>
                        <td class="category">AIä½œæ–‡è¯„ä¼°</td>
                        <td>ä½¿ç”¨Grammarly/ChatGPTè¯„ä¼°ä¸€ç¯‡ä½œæ–‡</td>
                        <td>æ ¹æ®AIåé¦ˆä¿®æ”¹å¹¶æäº¤æœ€ç»ˆç‰ˆ</td>
                        <td class="points">+15</td>
                        <td id="point6">0</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" class="checkbox" id="task7" onclick="updatePoints(15, this)"></td>
                        <td class="category">å£è¯­ç»ƒä¹ </td>
                        <td>ä½¿ç”¨è‹±è¯­é…éŸ³APPæˆ–AIå¯¹è¯å·¥å…·ç»ƒä¹ </td>
                        <td>è®°å½•åˆ†æ•°å¹¶æ¯”ä¸Šå‘¨æé«˜</td>
                        <td class="points">+15</td>
                        <td id="point7">0</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" class="checkbox" id="task8" onclick="updatePoints(20, this)"></td>
                        <td class="category">æ¨¡æ‹Ÿæµ‹è¯•</td>
                        <td>å®Œæˆä¸€å¥—å®Œæ•´æ¨¡æ‹Ÿæµ‹è¯•</td>
                        <td>ä¸¥æ ¼è®¡æ—¶ï¼Œè‡ªæˆ‘è¯„åˆ†</td>
                        <td class="points">+20</td>
                        <td id="point8">0</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" class="checkbox" id="task9" onclick="updatePoints(30, this)"></td>
                        <td class="category">å¤–éƒ¨æµ‹è¯„</td>
                        <td>å‘¨æœ«æ¨¡è€ƒä¸­å•é¡¹æˆç»©æ¯”ä¸Šå‘¨æœ‰æå‡</td>
                        <td>éœ€æœ‰ç¬¬ä¸‰æ–¹éªŒè¯æˆ–é€šè¿‡æ ‡å‡†æµ‹è¯•ç¡®è®¤</td>
                        <td class="points">+30</td>
                        <td id="point9">0</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="data-tab" class="tab-content">
        <div class="card">
            <h3>å­¦ä¹ æ•°æ®è®°å½•</h3>
            <p>è®°å½•è¯¦ç»†å­¦ä¹ æ•°æ®ä»¥ä¾¿è¿›è¡Œæ·±åº¦åˆ†æå’Œç­–ç•¥ä¼˜åŒ–</p>
            
            <div class="data-form">
                <div class="form-group">
                    <label for="learning-date">æ—¥æœŸ</label>
                    <input type="date" id="learning-date">
                </div>
                
                <div class="form-group">
                    <label for="study-time">å­¦ä¹ æ—¶é—´ (åˆ†é’Ÿ)</label>
                    <input type="number" id="study-time" min="0" max="240">
                </div>
                
                <div class="form-group">
                    <label for="vocab-score">è¯æ±‡å¾—åˆ†</label>
                    <input type="number" id="vocab-score" min="0" max="15">
                </div>
                
                <div class="form-group">
                    <label for="listening-score">å¬åŠ›å¾—åˆ†</label>
                    <input type="number" id="listening-score" min="0" max="20">
                </div>
                
                <div class="form-group">
                    <label for="reading-score">é˜…è¯»å¾—åˆ†</label>
                    <input type="number" id="reading-score" min="0" max="25">
                </div>
                
                <div class="form-group">
                    <label for="writing-score">å†™ä½œ/ç¿»è¯‘å¾—åˆ†</label>
                    <input type="number" id="writing-score" min="0" max="20">
                </div>
                
                <div class="form-group">
                    <label for="external-score">å¤–éƒ¨éªŒè¯å¾—åˆ†</label>
                    <input type="number" id="external-score" min="0" max="30">
                </div>
                
                <div class="form-group">
                    <label for="error-types">ä¸»è¦é”™è¯¯ç±»å‹</label>
                    <select id="error-types">
                        <option value="">--é€‰æ‹©ä¸»è¦é”™è¯¯--</option>
                        <option value="vocabulary">è¯æ±‡ä¸è¶³</option>
                        <option value="grammar">è¯­æ³•é”™è¯¯</option>
                        <option value="comprehension">ç†è§£åå·®</option>
                        <option value="time">æ—¶é—´ä¸è¶³</option>
                        <option value="focus">æ³¨æ„åŠ›ä¸é›†ä¸­</option>
                    </select>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                <button class="btn" onclick="saveLearningData()">ä¿å­˜å­¦ä¹ æ•°æ®</button>
                <button class="btn btn-danger" onclick="clearForm()">æ¸…ç©ºè¡¨å•</button>
            </div>
            
            <div class="data-records">
                <h3 style="margin-bottom: 15px;">å­¦ä¹ è®°å½•åˆ—è¡¨</h3>
                
                <div class="search-filter">
                    <input type="text" id="record-search" placeholder="æœç´¢æ—¥æœŸæˆ–é”™è¯¯ç±»å‹..." oninput="filterRecords()">
                    <button class="btn" onclick="showAllRecords()">æ˜¾ç¤ºå…¨éƒ¨</button>
                </div>
                
                <div id="records-container">
                    <!-- å­¦ä¹ è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <div id="stats-tab" class="tab-content">
        <div class="card">
            <h3>å­¦ä¹ æ•°æ®ç»Ÿè®¡</h3>
            <p>åŸºäºè®°å½•çš„æ•°æ®ç”Ÿæˆå­¦ä¹ æ´å¯Ÿï¼Œå¸®åŠ©ä¼˜åŒ–å­¦ä¹ ç­–ç•¥</p>
            
            <!-- ç»Ÿè®¡æ•°æ®åˆ†ç±»æ ‡ç­¾é¡µ -->
            <div class="stats-tabs">
                <div class="stats-tab active" onclick="switchStatsTab('weekly-stats')">æœ¬å‘¨ç»Ÿè®¡</div>
                <div class="stats-tab" onclick="switchStatsTab('monthly-stats')">æœ¬æœˆç»Ÿè®¡</div>
                <div class="stats-tab" onclick="switchStatsTab('overall-stats')">æ•´ä½“ç»Ÿè®¡</div>
            </div>
            
            <!-- æœ¬å‘¨ç»Ÿè®¡å†…å®¹ -->
            <div id="weekly-stats" class="stats-content active">
                <div class="stats-summary">
                    <h4>æœ¬å‘¨å­¦ä¹ æ‘˜è¦</h4>
                    <p>ç»Ÿè®¡å‘¨æœŸ: <span id="weekly-period">-- è‡³ --</span></p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>å¹³å‡æ¯æ—¥å¾—åˆ†</h4>
                        <div class="stat-value" id="weekly-avg-score">0</div>
                        <p>ç›®æ ‡: â‰¥80åˆ†</p>
                    </div>
                    
                    <div class="stat-card">
                        <h4>æœ€å¼ºèƒ½åŠ›é¡¹</h4>
                        <div class="stat-value" id="weekly-strongest">--</div>
                        <p>å¾—åˆ†æœ€é«˜çš„é¢†åŸŸ</p>
                    </div>
                    
                    <div class="stat-card">
                        <h4>æœ€éœ€æ”¹è¿›é¡¹</h4>
                        <div class="stat-value" id="weekly-weakest">--</div>
                        <p>éœ€è¦åŠ å¼ºçš„é¢†åŸŸ</p>
                    </div>
                    
                    <div class="stat-card">
                        <h4>å¹³å‡å­¦ä¹ æ—¶é—´</h4>
                        <div class="stat-value" id="weekly-avg-time">0</div>
                        <p>å•ä½: åˆ†é’Ÿ/å¤©</p>
                    </div>
                </div>
                
                <div class="stat-chart" id="weekly-chart">
                    <!-- å‘¨ç»Ÿè®¡å›¾è¡¨å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
                
                <div class="stats-summary">
                    <h4>ä¸»è¦é”™è¯¯åˆ†æ</h4>
                    <p id="weekly-errors">æš‚æ— æ•°æ®</p>
                </div>
            </div>
            
            <!-- æœ¬æœˆç»Ÿè®¡å†…å®¹ -->
            <div id="monthly-stats" class="stats-content">
                <div class="stats-summary">
                    <h4>æœ¬æœˆå­¦ä¹ æ‘˜è¦</h4>
                    <p>ç»Ÿè®¡å‘¨æœŸ: <span id="monthly-period">-- è‡³ --</span></p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>å¹³å‡æ¯æ—¥å¾—åˆ†</h4>
                        <div class="stat-value" id="monthly-avg-score">0</div>
                        <p>ç›®æ ‡: â‰¥80åˆ†</p>
                    </div>
                    
                    <div class="stat-card">
                        <h4>æœ€å¼ºèƒ½åŠ›é¡¹</h4>
                        <div class="stat-value" id="monthly-strongest">--</div>
                        <p>å¾—åˆ†æœ€é«˜çš„é¢†åŸŸ</p>
                    </div>
                    
                    <div class="stat-card">
                        <h4>æœ€éœ€æ”¹è¿›é¡¹</h4>
                        <div class="stat-value" id="monthly-weakest">--</div>
                        <p>éœ€è¦åŠ å¼ºçš„é¢†åŸŸ</p>
                    </div>
                    
                    <div class="stat-card">
                        <h4>å¹³å‡å­¦ä¹ æ—¶é—´</h4>
                        <div class="stat-value" id="monthly-avg-time">0</div>
                        <p>å•ä½: åˆ†é’Ÿ/å¤©</p>
                    </div>
                </div>
                
                <div class="stat-chart" id="monthly-chart">
                    <!-- æœˆç»Ÿè®¡å›¾è¡¨å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
                
                <div class="stats-summary">
                    <h4>ä¸»è¦é”™è¯¯åˆ†æ</h4>
                    <p id="monthly-errors">æš‚æ— æ•°æ®</p>
                </div>
            </div>
            
            <!-- æ•´ä½“ç»Ÿè®¡å†…å®¹ -->
            <div id="overall-stats" class="stats-content">
                <div class="stats-summary">
                    <h4>æ•´ä½“å­¦ä¹ æ‘˜è¦</h4>
                    <p>ç»Ÿè®¡å‘¨æœŸ: <span id="overall-period">-- è‡³ --</span></p>
                    <p>æ€»å­¦ä¹ å¤©æ•°: <span id="overall-days">0</span> å¤©</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>å¹³å‡æ¯æ—¥å¾—åˆ†</h4>
                        <div class="stat-value" id="overall-avg-score">0</div>
                        <p>ç›®æ ‡: â‰¥80åˆ†</p>
                    </div>
                    
                    <div class="stat-card">
                        <h4>æœ€å¼ºèƒ½åŠ›é¡¹</h4>
                        <div class="stat-value" id="overall-strongest">--</div>
                        <p>å¾—åˆ†æœ€é«˜çš„é¢†åŸŸ</p>
                    </div>
                    
                    <div class="stat-card">
                        <h4>æœ€éœ€æ”¹è¿›é¡¹</h4>
                        <div class="stat-value" id="overall-weakest">--</div>
                        <p>éœ€è¦åŠ å¼ºçš„é¢†åŸŸ</p>
                    </div>
                    
                    <div class="stat-card">
                        <h4>å­¦ä¹ è¾¾æˆç‡</h4>
                        <div class="stat-value" id="overall-achievement">0%</div>
                        <p>è¾¾åˆ°80åˆ†çš„æ¯”ä¾‹</p>
                    </div>
                </div>
                
                <div class="stat-chart" id="overall-chart">
                    <!-- æ•´ä½“ç»Ÿè®¡å›¾è¡¨å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
                
                <div class="stats-summary">
                    <h4>ä¸»è¦é”™è¯¯åˆ†æ</h4>
                    <p id="overall-errors">æš‚æ— æ•°æ®</p>
                </div>
            </div>
            
            <button class="btn" onclick="calculateAllStats()" style="margin-top: 20px;">æ›´æ–°ç»Ÿè®¡æŠ¥å‘Š</button>
        </div>
    </div>

    <div id="rewards-tab" class="tab-content">
        <div class="card">
            <h3>å¥–åŠ±å…‘æ¢æœºåˆ¶</h3>
            <ul>
                <li><strong>æ¯æ—¥å…‘æ¢</strong>: ç´¯è®¡å¾—åˆ† â‰¥ 80åˆ†ï¼Œå³å¯è·å¾—30åˆ†é’Ÿæ— è´Ÿç½ªæ„Ÿçš„å¨±ä¹æ—¶é—´ã€‚</li>
                <li><strong>æ¯å‘¨å…‘æ¢</strong>: æœ¬å‘¨æ¯æ—¥å¹³å‡åˆ† â‰¥ 85åˆ†ï¼Œå‘¨æœ«å¯äº«å—ä¸€æ¬¡"å¤§é¤"æˆ–"ç”µå½±"ã€‚</li>
                <li><strong>é˜¶æ®µå…‘æ¢ï¼ˆæ¯28å¤©ï¼‰</strong>: å®Œæˆé˜¶æ®µç›®æ ‡ä¸”æ¯å‘¨å‡åˆ†è¾¾æ ‡ï¼Œå…‘æ¢ä¸€æ¬¡ä¸­å‹å¥–åŠ±ï¼ˆå¦‚ä¹°ä¸€æœ¬å–œæ¬¢çš„ä¹¦ã€çœ‹ä¸€åœºæ¼”å‡ºï¼‰ã€‚</li>
                <li><strong>å¤–éƒ¨éªŒè¯å¥–åŠ±</strong>: æ¯å‘¨å®Œæˆ3é¡¹å¤–éƒ¨éªŒè¯ä»»åŠ¡ï¼Œé¢å¤–å¥–åŠ±ä¸€æ¬¡å°å‹å¨±ä¹æ´»åŠ¨ã€‚</li>
                <li><strong>ç»ˆæå¥–åŠ±</strong>: 84å¤©åè¾¾åˆ°650åˆ†ç›®æ ‡ï¼Œå¥–åŠ±è‡ªå·±ä¸€æ¬¡æ¢¦æƒ³ä¹‹æ—…æˆ–å¿ƒä»ªå·²ä¹…çš„ç”µå­äº§å“ã€‚</li>
            </ul>
            
            <div style="margin-top: 20px; padding: 15px; background-color: #e8f4f8; border-radius: 8px;">
                <h4>æœ¬å‘¨å¯å…‘æ¢å¥–åŠ±</h4>
                <p id="available-rewards">æ¯æ—¥å¾—åˆ†è¾¾åˆ°80åˆ†å³å¯è§£é”å¥–åŠ±</p>
                <button class="btn" onclick="claimReward()" style="margin-top: 10px;">é¢†å–å¥–åŠ±</button>
            </div>
        </div>
    </div>

    <div id="sync-tab" class="tab-content">
        <div class="card">
            <h3>æ•°æ®åŒæ­¥è®¾ç½®</h3>
            <p>é…ç½®åŒæ­¥ä»¥åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šä¿æŒæ•°æ®ä¸€è‡´</p>
            
            <div class="sync-settings">
                <div class="form-group">
                    <label for="user-id">ç”¨æˆ·ID</label>
                    <input type="text" id="user-id" placeholder="è¾“å…¥æ‚¨çš„å”¯ä¸€ç”¨æˆ·IDï¼ˆè·¨è®¾å¤‡ä½¿ç”¨ç›¸åŒIDï¼‰">
                    <small style="color: var(--text-light);">ä½¿ç”¨ç›¸åŒIDåœ¨ä¸åŒè®¾å¤‡ä¸ŠåŒæ­¥æ•°æ®</small>
                </div>
                
                <div class="form-group">
                    <label for="github-token">GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ (å¯é€‰)</label>
                    <input type="password" id="github-token" placeholder="è¾“å…¥æ‚¨çš„GitHubä»¤ç‰Œ">
                    <small style="color: var(--text-light);">éœ€è¦åˆ›å»ºå¸¦æœ‰gistæƒé™çš„ä¸ªäººè®¿é—®ä»¤ç‰Œ</small>
                </div>
                
                <div class="form-group">
                    <label for="gist-id">Gist ID (å¯é€‰)</label>
                    <input type="text" id="gist-id" placeholder="è¾“å…¥å­˜å‚¨æ•°æ®çš„Gist ID">
                    <small style="color: var(--text-light);">å¦‚æœæ²¡æœ‰ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ›å»ºæ–°çš„Gist</small>
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="toggleCloudSync()">
                        <span id="sync-toggle-text">å¯ç”¨äº‘åŒæ­¥</span>
                    </button>
                    <button class="btn btn-sync" onclick="createNewGist()" style="margin-right: 10px;">åˆ›å»ºæ–°Gist</button>
                    <button class="btn" onclick="saveSyncSettings()">ä¿å­˜è®¾ç½®</button>
                </div>
                
                <!-- æ–°å¢ï¼šæ‰‹åŠ¨åŒæ­¥å’Œå¤‡ä»½åŠŸèƒ½ -->
                <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                    <button class="btn btn-sync" onclick="manualSync()">æ‰‹åŠ¨åŒæ­¥</button>
                    <button class="btn" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(event)">
                    <button class="btn" onclick="document.getElementById('import-file').click()">å¯¼å…¥æ•°æ®</button>
                </div>
                
                <div style="margin-top: 15px;">
                    <p><strong>äº‘åŒæ­¥çŠ¶æ€:</strong> <span id="cloud-sync-status">æœªå¯ç”¨</span></p>
                    <p><strong>æœ€ååŒæ­¥æ—¶é—´:</strong> <span id="last-sync-time">ä»æœªåŒæ­¥</span></p>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <h4>åŒæ­¥å†å²</h4>
                <p id="sync-history">æš‚æ— åŒæ­¥è®°å½•</p>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Project CET-6-650 | åŸºäºDeepSeek-R1å¼ºåŒ–å­¦ä¹ æ–¹æ³•è®º | ç¬¬ <span id="day-counter">1</span> å¤©/84å¤©</p>
    </div>

    <div class="save-indicator" id="save-indicator">æ•°æ®å·²ä¿å­˜</div>

    <script>
        let totalPoints = 0;
        let learningData = [];
        let weeklyData = {
            startDate: null,
            dailyScores: []
        };
        let syncSettings = {
            userId: '',
            githubToken: '',
            gistId: '',
            cloudSyncEnabled: false
        };
        let syncHistory = [];
        let lastSyncTime = null;
        let currentEditingIndex = -1; // ç”¨äºè·Ÿè¸ªå½“å‰æ­£åœ¨ç¼–è¾‘çš„è®°å½•ç´¢å¼•
        
        // ä¸ºæ¯ä¸€è¡Œæ·»åŠ IDä»¥ä¾¿è¯†åˆ«
        document.addEventListener('DOMContentLoaded', function() {
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach((row, index) => {
                row.id = index + 1;
            });
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            const today = new Date();
            document.getElementById('date').value = formatDate(today);
            document.getElementById('learning-date').value = formatDate(today);
            
            // åˆå§‹åŒ–å€’è®¡æ—¶
            updateExamCountdown();
            // æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡å€’è®¡æ—¶
            setInterval(updateExamCountdown, 3600000);
            
            // åŠ è½½ä¿å­˜çš„æ•°æ®
            loadLocalData();
            loadSyncSettings();
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°æ¯æ—¥æ•°æ®
            checkAndUpdateDailyData();
            
            // æ˜¾ç¤ºå­¦ä¹ è®°å½•
            displayLearningRecords();
            
            // è‡ªåŠ¨è®¡ç®—ç»Ÿè®¡æ•°æ®
            calculateAllStats();
            
            // è‡ªåŠ¨åŒæ­¥æ•°æ®ï¼ˆå¦‚æœå·²é…ç½®ï¼‰
            if (syncSettings.cloudSyncEnabled && syncSettings.userId) {
                setTimeout(syncData, 3000);
            }
            
            // å®šæ—¶è‡ªåŠ¨åŒæ­¥ï¼ˆæ¯30åˆ†é’Ÿï¼‰
            setInterval(() => {
                if (syncSettings.cloudSyncEnabled && syncSettings.userId) {
                    syncData();
                }
            }, 1800000);
        });
        
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // è·å–åŒ—äº¬æ—¶åŒºçš„å½“å‰æ—¥æœŸ
        function getBeijingDate() {
            const now = new Date();
            // åŒ—äº¬æ—¶é—´æ˜¯UTC+8
            const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            return beijingTime;
        }
        
        // æ›´æ–°è€ƒè¯•å€’è®¡æ—¶
        function updateExamCountdown() {
            // è®¾ç½®è€ƒè¯•æ—¥æœŸä¸º2025å¹´12æœˆ13æ—¥ï¼ˆå¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰
            const examDate = new Date('2025-12-13');
            // ä½¿ç”¨åŒ—äº¬æ—¶åŒºæ—¥æœŸè®¡ç®—
            const today = getBeijingDate();
            
            // è®¡ç®—å‰©ä½™å¤©æ•°
            const timeDiff = examDate.getTime() - today.getTime();
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('countdown-days').textContent = daysDiff > 0 ? daysDiff : 0;
        }
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°æ¯æ—¥æ•°æ®
        function checkAndUpdateDailyData() {
            const lastActivityDate = localStorage.getItem('lastActivityDate');
            const today = formatDate(getBeijingDate());
            
            // å¦‚æœæ˜¯æ–°çš„ä¸€å¤©ï¼Œé‡ç½®æ¯æ—¥ä»»åŠ¡ä½†ä¿ç•™ç´¯è®¡æ•°æ®
            if (!lastActivityDate || lastActivityDate !== today) {
                resetDailyTasks();
                // ä¿å­˜ä»Šå¤©çš„æ—¥æœŸä½œä¸ºæœ€åæ´»åŠ¨æ—¥æœŸ
                localStorage.setItem('lastActivityDate', today);
                
                // å°†æ˜¨å¤©çš„åˆ†æ•°æ·»åŠ åˆ°å‘¨æ•°æ®ä¸­
                const savedTasks = JSON.parse(localStorage.getItem('englishLearningTasks') || '{"totalPoints":0}');
                if (savedTasks.totalPoints > 0) {
                    addToWeeklyData(savedTasks.totalPoints, lastActivityDate || today);
                }
            }
        }
        
        // é‡ç½®æ¯æ—¥ä»»åŠ¡
        function resetDailyTasks() {
            // é‡ç½®ä»»åŠ¡çŠ¶æ€
            for (let i = 1; i <= 9; i++) {
                const checkbox = document.getElementById(`task${i}`);
                const pointElement = document.getElementById(`point${i}`);
                if (checkbox) {
                    checkbox.checked = false;
                    pointElement.textContent = '0';
                }
            }
            
            // é‡ç½®æ€»åˆ†
            totalPoints = 0;
            document.getElementById('current-points').textContent = totalPoints;
            document.getElementById('progress-fill').style.width = '0%';
            document.getElementById('progress-text').textContent = '0%';
            
            // æ›´æ–°å¯å…‘æ¢å¥–åŠ±æ˜¾ç¤º
            updateAvailableRewards();
            
            // ä¿å­˜é‡ç½®åçš„æ•°æ®
            saveLocalData();
        }
        
        // æ·»åŠ åˆ°å‘¨æ•°æ®ç»Ÿè®¡
        function addToWeeklyData(score, date) {
            // åŠ è½½å‘¨æ•°æ®
            const savedWeeklyData = localStorage.getItem('weeklyLearningData');
            if (savedWeeklyData) {
                weeklyData = JSON.parse(savedWeeklyData);
            }
            
            // å¦‚æœæ˜¯æ–°çš„ä¸€å‘¨ï¼Œé‡ç½®å‘¨æ•°æ®
            const today = getBeijingDate();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay() + (today.getDay() === 0 ? -6 : 1)); // å‘¨ä¸€ä¸ºä¸€å‘¨çš„å¼€å§‹
            
            if (!weeklyData.startDate || new Date(weeklyData.startDate) < weekStart) {
                weeklyData = {
                    startDate: formatDate(weekStart),
                    dailyScores: []
                };
            }
            
            // æ·»åŠ ä»Šæ—¥åˆ†æ•°
            weeklyData.dailyScores.push({
                date: date,
                score: score
            });
            
            // ä¿å­˜å‘¨æ•°æ®
            localStorage.setItem('weeklyLearningData', JSON.stringify(weeklyData));
        }
        
        // åŠ è½½æœ¬åœ°ä¿å­˜çš„æ•°æ®
        function loadLocalData() {
            // åŠ è½½å‘¨æ•°æ®
            const savedWeeklyData = localStorage.getItem('weeklyLearningData');
            if (savedWeeklyData) {
                weeklyData = JSON.parse(savedWeeklyData);
            }
            
            // åŠ è½½ä»»åŠ¡çŠ¶æ€
            const savedTasks = localStorage.getItem('englishLearningTasks');
            if (savedTasks) {
                const tasks = JSON.parse(savedTasks);
                totalPoints = tasks.totalPoints || 0;
                
                // æ›´æ–°UI
                document.getElementById('current-points').textContent = totalPoints;
                const percentage = totalPoints;
                document.getElementById('progress-fill').style.width = `${percentage}%`;
                document.getElementById('progress-text').textContent = `${percentage}%`;
                
                // è®¾ç½®å¤é€‰æ¡†çŠ¶æ€
                for (let i = 1; i <= 9; i++) {
                    const checkbox = document.getElementById(`task${i}`);
                    const pointElement = document.getElementById(`point${i}`);
                    if (checkbox && tasks[`task${i}`]) {
                        checkbox.checked = true;
                        pointElement.textContent = tasks[`task${i}`].points;
                    }
                }
                
                updateAvailableRewards();
            }
            
            // åŠ è½½å­¦ä¹ æ•°æ®
            const savedLearningData = localStorage.getItem('englishLearningData');
            if (savedLearningData) {
                learningData = JSON.parse(savedLearningData);
            }
            
            // åŠ è½½åŒæ­¥å†å²
            const savedSyncHistory = localStorage.getItem('syncHistory');
            if (savedSyncHistory) {
                syncHistory = JSON.parse(savedSyncHistory);
                updateSyncHistoryDisplay();
            }
            
            // æ›´æ–°å¤©æ•°è®¡æ•°å™¨
            const startDate = new Date('2023-09-01');
            const today = getBeijingDate();
            const diffTime = Math.abs(today - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            document.getElementById('day-counter').textContent = Math.min(diffDays, 84);
        }
        
        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveLocalData() {
            // ä¿å­˜ä»»åŠ¡çŠ¶æ€
            const tasksToSave = {
                totalPoints: totalPoints
            };
            
            for (let i = 1; i <= 9; i++) {
                const checkbox = document.getElementById(`task${i}`);
                const pointElement = document.getElementById(`point${i}`);
                if (checkbox && checkbox.checked) {
                    tasksToSave[`task${i}`] = {
                        checked: true,
                        points: parseInt(pointElement.textContent)
                    };
                }
            }
            
            localStorage.setItem('englishLearningTasks', JSON.stringify(tasksToSave));
            
            // ä¿å­˜å­¦ä¹ æ•°æ®
            localStorage.setItem('englishLearningData', JSON.stringify(learningData));
            
            // ä¿å­˜æœ€åæ´»åŠ¨æ—¥æœŸ
            localStorage.setItem('lastActivityDate', formatDate(getBeijingDate()));
            
            // æ˜¾ç¤ºä¿å­˜æç¤º
            const indicator = document.getElementById('save-indicator');
            indicator.style.opacity = '1';
            setTimeout(() => {
                indicator.style.opacity = '0';
            }, 2000);
            
            // æ•°æ®å˜åŒ–åè‡ªåŠ¨æ›´æ–°ç»Ÿè®¡
            calculateAllStats();
            
            // è‡ªåŠ¨åŒæ­¥ï¼ˆå¦‚æœå·²é…ç½®ä¸”æ•°æ®æœ‰å˜åŒ–ï¼‰
            if (syncSettings.cloudSyncEnabled && syncSettings.userId && 
                (lastSyncTime === null || new Date() - lastSyncTime > 300000)) { // 5åˆ†é’Ÿå†…ä¸é‡å¤åŒæ­¥
                syncData();
            }
        }
        
        // åŒæ­¥è®¾ç½®ç›¸å…³å‡½æ•°
        function loadSyncSettings() {
            const savedSettings = localStorage.getItem('syncSettings');
            if (savedSettings) {
                syncSettings = JSON.parse(savedSettings);
                document.getElementById('user-id').value = syncSettings.userId || '';
                document.getElementById('github-token').value = syncSettings.githubToken || '';
                document.getElementById('gist-id').value = syncSettings.gistId || '';
                
                // æ›´æ–°åŒæ­¥çŠ¶æ€æ˜¾ç¤º
                updateSyncStatusDisplay();
            }
            
            // åŠ è½½æœ€ååŒæ­¥æ—¶é—´
            const savedLastSync = localStorage.getItem('lastSyncTime');
            if (savedLastSync) {
                lastSyncTime = new Date(savedLastSync);
                document.getElementById('last-sync-time').textContent = lastSyncTime.toLocaleString();
            }
        }
        
        function saveSyncSettings() {
            syncSettings.userId = document.getElementById('user-id').value;
            syncSettings.githubToken = document.getElementById('github-token').value;
            syncSettings.gistId = document.getElementById('gist-id').value;
            
            localStorage.setItem('syncSettings', JSON.stringify(syncSettings));
            
            // æ›´æ–°åŒæ­¥çŠ¶æ€æ˜¾ç¤º
            updateSyncStatusDisplay();
            
            addSyncHistory('åŒæ­¥è®¾ç½®å·²ä¿å­˜');
            showSyncStatus('è®¾ç½®å·²ä¿å­˜');
        }
        
        function toggleCloudSync() {
            const userId = document.getElementById('user-id').value;
            if (!userId && !syncSettings.cloudSyncEnabled) {
                alert('è¯·å…ˆè¾“å…¥ç”¨æˆ·ID');
                document.getElementById('user-id').focus();
                return;
            }
            
            syncSettings.cloudSyncEnabled = !syncSettings.cloudSyncEnabled;
            saveSyncSettings();
            
            if (syncSettings.cloudSyncEnabled) {
                addSyncHistory('äº‘åŒæ­¥å·²å¯ç”¨');
                showSyncStatus('äº‘åŒæ­¥å·²å¯ç”¨');
                // ç«‹å³åŒæ­¥ä¸€æ¬¡
                syncData();
            } else {
                addSyncHistory('äº‘åŒæ­¥å·²ç¦ç”¨');
                showSyncStatus('äº‘åŒæ­¥å·²ç¦ç”¨');
            }
        }
        
        function updateSyncStatusDisplay() {
            document.getElementById('cloud-sync-status').textContent = 
                syncSettings.cloudSyncEnabled ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨';
            
            document.getElementById('sync-toggle-text').textContent = 
                syncSettings.cloudSyncEnabled ? 'ç¦ç”¨äº‘åŒæ­¥' : 'å¯ç”¨äº‘åŒæ­¥';
        }
        
        function createNewGist() {
            if (!syncSettings.githubToken) {
                alert('è¯·å…ˆè¾“å…¥GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ');
                return;
            }
            
            showSyncingStatus();
            
            const fileContent = JSON.stringify({
                lastUpdated: new Date().toISOString(),
                userId: syncSettings.userId,
                tasks: JSON.parse(localStorage.getItem('englishLearningTasks') || '{"totalPoints":0}'),
                learningData: learningData,
                weeklyData: weeklyData
            }, null, 2);
            
            fetch('https://api.github.com/gists', {
                method: 'POST',
                headers: {
                    'Authorization': `token ${syncSettings.githubToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    description: 'è‹±è¯­å­¦ä¹ ç³»ç»Ÿæ•°æ®å­˜å‚¨',
                    public: false,
                    files: {
                        'english_learning_data.json': {
                            content: fileContent
                        }
                    }
                })
            })
            .then(response => {
                if (!response.ok) throw new Error('åˆ›å»ºGistå¤±è´¥');
                return response.json();
            })
            .then(data => {
                syncSettings.gistId = data.id;
                document.getElementById('gist-id').value = data.id;
                saveSyncSettings();
                addSyncHistory('å·²åˆ›å»ºæ–°Gistå¹¶åŒæ­¥æ•°æ®');
                showSyncStatus('Giståˆ›å»ºæˆåŠŸ');
            })
            .catch(error => {
                console.error('åˆ›å»ºGisté”™è¯¯:', error);
                showSyncStatus('åˆ›å»ºå¤±è´¥: ' + error.message);
                addSyncHistory('åˆ›å»ºGistå¤±è´¥: ' + error.message);
            });
        }
        
        // æ‰‹åŠ¨åŒæ­¥åŠŸèƒ½
        function manualSync() {
            if (!syncSettings.cloudSyncEnabled) {
                alert('è¯·å…ˆå¯ç”¨äº‘åŒæ­¥');
                return;
            }
            
            if (!syncSettings.userId) {
                alert('è¯·å…ˆè®¾ç½®ç”¨æˆ·ID');
                document.getElementById('user-id').focus();
                return;
            }
            
            syncData();
        }
        
        // å¯¼å‡ºæ•°æ®åŠŸèƒ½
        function exportData() {
            const exportData = {
                lastUpdated: new Date().toISOString(),
                userId: syncSettings.userId,
                tasks: JSON.parse(localStorage.getItem('englishLearningTasks') || '{"totalPoints":0}'),
                learningData: learningData,
                weeklyData: weeklyData
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `english_learning_data_${formatDate(new Date())}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            addSyncHistory('æ•°æ®å·²å¯¼å‡º');
            showSyncStatus('æ•°æ®å¯¼å‡ºæˆåŠŸ');
        }
        
        // å¯¼å…¥æ•°æ®åŠŸèƒ½
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ•°æ®ã€‚')) {
                        // æ›´æ–°æœ¬åœ°å­˜å‚¨
                        if (importedData.tasks) {
                            localStorage.setItem('englishLearningTasks', JSON.stringify(importedData.tasks));
                        }
                        if (importedData.learningData) {
                            learningData = importedData.learningData;
                            localStorage.setItem('englishLearningData', JSON.stringify(learningData));
                        }
                        if (importedData.weeklyData) {
                            weeklyData = importedData.weeklyData;
                            localStorage.setItem('weeklyLearningData', JSON.stringify(weeklyData));
                        }
                        
                        // å¦‚æœå¯¼å…¥æ•°æ®åŒ…å«ç”¨æˆ·IDï¼Œæ›´æ–°å½“å‰ç”¨æˆ·ID
                        if (importedData.userId) {
                            syncSettings.userId = importedData.userId;
                            document.getElementById('user-id').value = importedData.userId;
                            saveSyncSettings();
                        }
                        
                        // é‡æ–°åŠ è½½æ•°æ®å¹¶æ›´æ–°UI
                        loadLocalData();
                        displayLearningRecords();
                        calculateAllStats();
                        
                        addSyncHistory('æ•°æ®å·²å¯¼å…¥');
                        showSyncStatus('æ•°æ®å¯¼å…¥æˆåŠŸ');
                    }
                } catch (error) {
                    console.error('å¯¼å…¥æ•°æ®é”™è¯¯:', error);
                    alert('å¯¼å…¥å¤±è´¥: æ— æ•ˆçš„JSONæ–‡ä»¶');
                    addSyncHistory('æ•°æ®å¯¼å…¥å¤±è´¥: æ— æ•ˆæ–‡ä»¶');
                }
            };
            reader.readAsText(file);
            
            // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡å¤é€‰æ‹©åŒä¸€ä¸ªæ–‡ä»¶
            document.getElementById('import-file').value = '';
        }
        
        // æ•°æ®åŒæ­¥ç›¸å…³å‡½æ•°
        function syncData() {
            if (!syncSettings.cloudSyncEnabled) {
                alert('è¯·å…ˆå¯ç”¨äº‘åŒæ­¥');
                return;
            }
            
            if (!syncSettings.userId) {
                alert('è¯·å…ˆè®¾ç½®ç”¨æˆ·ID');
                document.getElementById('user-id').focus();
                return;
            }
            
            showSyncingStatus();
            
            // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨GitHub GiståŒæ­¥
            if (syncSettings.githubToken && syncSettings.gistId) {
                syncWithGitHub();
            } else {
                // ä½¿ç”¨localStorageæ¨¡æ‹Ÿäº‘åŒæ­¥
                syncWithLocalStorage();
            }
        }
        
        // ä½¿ç”¨GitHubåŒæ­¥
        function syncWithGitHub() {
            // å…ˆè·å–è¿œç¨‹æ•°æ®
            fetch(`https://api.github.com/gists/${syncSettings.gistId}`, {
                headers: {
                    'Authorization': `token ${syncSettings.githubToken}`
                }
            })
            .then(response => {
                if (!response.ok) {
                    if (response.status === 404) {
                        // Gistä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„
                        return createNewGist().then(() => null);
                    }
                    throw new Error('è·å–è¿œç¨‹æ•°æ®å¤±è´¥');
                }
                return response.json();
            })
            .then(remoteGist => {
                if (!remoteGist) return; // å¦‚æœæ˜¯æ–°å»ºçš„Gistï¼Œç›´æ¥è¿”å›
                
                const remoteData = JSON.parse(
                    remoteGist.files['english_learning_data.json'].content
                );
                
                // éªŒè¯ç”¨æˆ·IDåŒ¹é…
                if (remoteData.userId && remoteData.userId !== syncSettings.userId) {
                    throw new Error('ç”¨æˆ·IDä¸åŒ¹é…ï¼Œæ— æ³•åŒæ­¥');
                }
                
                const localLastUpdated = localStorage.getItem('lastSyncTime') || new Date(0).toISOString();
                
                // æ¯”è¾ƒè¿œç¨‹å’Œæœ¬åœ°æ•°æ®çš„æ›´æ–°æ—¶é—´
                if (new Date(remoteData.lastUpdated) > new Date(localLastUpdated)) {
                    // è¿œç¨‹æ•°æ®æ›´æ–°ï¼Œä½¿ç”¨è¿œç¨‹æ•°æ®
                    return new Promise((resolve) => {
                        if (confirm('å‘ç°æ›´æ–°çš„æ•°æ®ï¼Œæ˜¯å¦åŒæ­¥åˆ°æœ¬åœ°ï¼Ÿ')) {
                            localStorage.setItem('englishLearningTasks', JSON.stringify(remoteData.tasks));
                            learningData = remoteData.learningData;
                            weeklyData = remoteData.weeklyData;
                            localStorage.setItem('englishLearningData', JSON.stringify(learningData));
                            localStorage.setItem('weeklyLearningData', JSON.stringify(weeklyData));
                            
                            loadLocalData(); // é‡æ–°åŠ è½½æ•°æ®æ›´æ–°UI
                            displayLearningRecords(); // æ›´æ–°å­¦ä¹ è®°å½•æ˜¾ç¤º
                            calculateAllStats(); // æ›´æ–°ç»Ÿè®¡æ•°æ®
                            addSyncHistory('å·²ä»è¿œç¨‹åŒæ­¥æœ€æ–°æ•°æ®');
                            resolve(true);
                        } else {
                            resolve(false);
                        }
                    });
                } else {
                    // æœ¬åœ°æ•°æ®æ›´æ–°ï¼Œä¸Šä¼ åˆ°è¿œç¨‹
                    return false;
                }
            })
            .then(remoteWasNewer => {
                if (remoteWasNewer === null) return; // æ–°å»ºGistçš„æƒ…å†µ
                
                if (!remoteWasNewer) {
                    // ä¸Šä¼ æœ¬åœ°æ•°æ®åˆ°è¿œç¨‹
                    const fileContent = JSON.stringify({
                        lastUpdated: new Date().toISOString(),
                        userId: syncSettings.userId,
                        tasks: JSON.parse(localStorage.getItem('englishLearningTasks') || '{"totalPoints":0}'),
                        learningData: learningData,
                        weeklyData: weeklyData
                    }, null, 2);
                    
                    return fetch(`https://api.github.com/gists/${syncSettings.gistId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${syncSettings.githubToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            files: {
                                'english_learning_data.json': {
                                    content: fileContent
                                }
                            }
                        })
                    })
                    .then(response => {
                        if (!response.ok) throw new Error('ä¸Šä¼ æ•°æ®å¤±è´¥');
                        localStorage.setItem('lastSyncTime', new Date().toISOString());
                        lastSyncTime = new Date();
                        document.getElementById('last-sync-time').textContent = lastSyncTime.toLocaleString();
                        addSyncHistory('å·²å°†æœ¬åœ°æ•°æ®åŒæ­¥åˆ°è¿œç¨‹');
                        return true;
                    });
                }
                return true;
            })
            .then(success => {
                if (success) {
                    showSyncStatus('åŒæ­¥æˆåŠŸ');
                }
            })
            .catch(error => {
                console.error('åŒæ­¥é”™è¯¯:', error);
                showSyncStatus('åŒæ­¥å¤±è´¥: ' + error.message);
                addSyncHistory('åŒæ­¥å¤±è´¥: ' + error.message);
            });
        }
        
        // ä½¿ç”¨localStorageæ¨¡æ‹Ÿäº‘åŒæ­¥
        function syncWithLocalStorage() {
            try {
                // å­˜å‚¨é”®åŒ…å«ç”¨æˆ·IDï¼Œå®ç°å¤šç”¨æˆ·éš”ç¦»
                const storageKey = `cloud_sync_${syncSettings.userId}`;
                
                // è·å–è¿œç¨‹æ•°æ®ï¼ˆå®é™…æ˜¯localStorageä¸­çš„æ•°æ®ï¼‰
                const remoteDataStr = localStorage.getItem(storageKey);
                const localLastUpdated = localStorage.getItem('lastSyncTime') || new Date(0).toISOString();
                
                if (remoteDataStr) {
                    const remoteData = JSON.parse(remoteDataStr);
                    
                    // æ¯”è¾ƒè¿œç¨‹å’Œæœ¬åœ°æ•°æ®çš„æ›´æ–°æ—¶é—´
                    if (new Date(remoteData.lastUpdated) > new Date(localLastUpdated)) {
                        // è¿œç¨‹æ•°æ®æ›´æ–°ï¼Œä½¿ç”¨è¿œç¨‹æ•°æ®
                        if (confirm('å‘ç°æ›´æ–°çš„æ•°æ®ï¼Œæ˜¯å¦åŒæ­¥åˆ°æœ¬åœ°ï¼Ÿ')) {
                            localStorage.setItem('englishLearningTasks', JSON.stringify(remoteData.tasks));
                            learningData = remoteData.learningData;
                            weeklyData = remoteData.weeklyData;
                            localStorage.setItem('englishLearningData', JSON.stringify(learningData));
                            localStorage.setItem('weeklyLearningData', JSON.stringify(weeklyData));
                            
                            loadLocalData(); // é‡æ–°åŠ è½½æ•°æ®æ›´æ–°UI
                            displayLearningRecords(); // æ›´æ–°å­¦ä¹ è®°å½•æ˜¾ç¤º
                            calculateAllStats(); // æ›´æ–°ç»Ÿè®¡æ•°æ®
                            addSyncHistory('å·²ä»äº‘åŒæ­¥æœ€æ–°æ•°æ®');
                        }
                    }
                }
                
                // ä¸Šä¼ æœ¬åœ°æ•°æ®åˆ°"äº‘ç«¯"ï¼ˆå®é™…æ˜¯localStorageï¼‰
                const localData = {
                    lastUpdated: new Date().toISOString(),
                    userId: syncSettings.userId,
                    tasks: JSON.parse(localStorage.getItem('englishLearningTasks') || '{"totalPoints":0}'),
                    learningData: learningData,
                    weeklyData: weeklyData
                };
                
                localStorage.setItem(storageKey, JSON.stringify(localData));
                localStorage.setItem('lastSyncTime', new Date().toISOString());
                lastSyncTime = new Date();
                document.getElementById('last-sync-time').textContent = lastSyncTime.toLocaleString();
                
                addSyncHistory('æœ¬åœ°æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯');
                showSyncStatus('åŒæ­¥æˆåŠŸ');
            } catch (error) {
                console.error('åŒæ­¥é”™è¯¯:', error);
                showSyncStatus('åŒæ­¥å¤±è´¥: ' + error.message);
                addSyncHistory('åŒæ­¥å¤±è´¥: ' + error.message);
            }
        }
        
        function addSyncHistory(message) {
            const now = new Date();
            const timeString = now.toLocaleString();
            syncHistory.unshift({
                time: timeString,
                message: message
            });
            
            // åªä¿ç•™æœ€è¿‘10æ¡è®°å½•
            if (syncHistory.length > 10) {
                syncHistory = syncHistory.slice(0, 10);
            }
            
            localStorage.setItem('syncHistory', JSON.stringify(syncHistory));
            updateSyncHistoryDisplay();
        }
        
        function updateSyncHistoryDisplay() {
            const historyElement = document.getElementById('sync-history');
            if (syncHistory.length === 0) {
                historyElement.textContent = 'æš‚æ— åŒæ­¥è®°å½•';
                return;
            }
            
            let html = '<ul style="padding-left: 20px;">';
            syncHistory.forEach(item => {
                html += `<li><strong>${item.time}</strong>: ${item.message}</li>`;
            });
            html += '</ul>';
            historyElement.innerHTML = html;
        }
        
        function showSyncingStatus() {
            document.getElementById('sync-status-text').textContent = 'åŒæ­¥ä¸­...';
            document.querySelector('.sync-icon').style.display = 'inline';
        }
        
        function showSyncStatus(message) {
            document.getElementById('sync-status-text').textContent = message;
            document.querySelector('.sync-icon').style.display = 'none';
        }
        
        // åŸæœ‰åŠŸèƒ½å‡½æ•°
        function switchTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // å–æ¶ˆæ‰€æœ‰æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabId).classList.add('active');
            
            // è®¾ç½®é€‰ä¸­çš„æ ‡ç­¾ä¸ºæ´»åŠ¨çŠ¶æ€
            document.querySelector(`.nav-tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
            
            // ä¿å­˜æ•°æ®
            saveLocalData();
        }
        
        // åˆ‡æ¢ç»Ÿè®¡æ ‡ç­¾é¡µ
        function switchStatsTab(tabId) {
            // éšè—æ‰€æœ‰ç»Ÿè®¡å†…å®¹
            document.querySelectorAll('.stats-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // å–æ¶ˆæ‰€æœ‰ç»Ÿè®¡æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.stats-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„ç»Ÿè®¡å†…å®¹
            document.getElementById(tabId).classList.add('active');
            
            // è®¾ç½®é€‰ä¸­çš„ç»Ÿè®¡æ ‡ç­¾ä¸ºæ´»åŠ¨çŠ¶æ€
            document.querySelector(`.stats-tab[onclick="switchStatsTab('${tabId}')"]`).classList.add('active');
        }
        
        function updatePoints(points, checkbox) {
            const row = checkbox.closest('tr');
            const pointId = row.id;
            const pointElement = document.getElementById(`point${pointId}`);
            
            if (checkbox.checked) {
                totalPoints += points;
                pointElement.textContent = points;
            } else {
                totalPoints -= points;
                pointElement.textContent = '0';
            }
            
            document.getElementById('current-points').textContent = totalPoints;
            const percentage = totalPoints;
            document.getElementById('progress-fill').style.width = `${percentage}%`;
            document.getElementById('progress-text').textContent = `${percentage}%`;
            
            // æ›´æ–°å¯å…‘æ¢å¥–åŠ±æ˜¾ç¤º
            updateAvailableRewards();
            
            // ä¿å­˜æ•°æ®
            saveLocalData();
        }
        
        function updateDate() {
            const dateInput = document.getElementById('date');
            const selectedDate = new Date(dateInput.value);
            const startDate = new Date('2023-09-01'); // è®¡åˆ’å¼€å§‹æ—¥æœŸ
            const diffTime = Math.abs(selectedDate - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            
            if (diffDays >= 1 && diffDays <= 84) {
                document.getElementById('day-counter').textContent = diffDays;
            } else {
                alert('è¯·è¾“å…¥84å¤©è®¡åˆ’å†…çš„æœ‰æ•ˆæ—¥æœŸ');
            }
            
            // ä¿å­˜æ•°æ®
            saveLocalData();
        }
        
        // å­¦ä¹ æ•°æ®ç®¡ç†åŠŸèƒ½
        function saveLearningData() {
            const date = document.getElementById('learning-date').value;
            if (!date) {
                alert('è¯·é€‰æ‹©æ—¥æœŸ');
                return;
            }
            
            const data = {
                date: date,
                studyTime: document.getElementById('study-time').value,
                vocabScore: document.getElementById('vocab-score').value,
                listeningScore: document.getElementById('listening-score').value,
                readingScore: document.getElementById('reading-score').value,
                writingScore: document.getElementById('writing-score').value,
                externalScore: document.getElementById('external-score').value,
                errorType: document.getElementById('error-types').value
            };
            
            // è®¡ç®—æ€»åˆ†
            const total = parseInt(data.vocabScore || 0) + 
                          parseInt(data.listeningScore || 0) + 
                          parseInt(data.readingScore || 0) + 
                          parseInt(data.writingScore || 0) + 
                          parseInt(data.externalScore || 0);
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ç¼–è¾‘æ¨¡å¼
            if (currentEditingIndex !== -1) {
                // æ›´æ–°ç°æœ‰è®°å½•
                learningData[currentEditingIndex] = data;
                alert(`å­¦ä¹ æ•°æ®å·²æ›´æ–°ï¼æ€»åˆ†: ${total}`);
                currentEditingIndex = -1; // é‡ç½®ç¼–è¾‘çŠ¶æ€
            } else {
                // æ£€æŸ¥æ˜¯å¦å·²æœ‰è¯¥æ—¥æœŸçš„æ•°æ®
                const existingIndex = learningData.findIndex(item => item.date === data.date);
                if (existingIndex >= 0) {
                    if (confirm('è¯¥æ—¥æœŸå·²æœ‰æ•°æ®ï¼Œæ˜¯å¦è¦†ç›–ï¼Ÿ')) {
                        learningData[existingIndex] = data;
                        alert(`å­¦ä¹ æ•°æ®å·²æ›´æ–°ï¼æ€»åˆ†: ${total}`);
                    } else {
                        return;
                    }
                } else {
                    // æ·»åŠ æ–°è®°å½•
                    learningData.push(data);
                    alert(`å­¦ä¹ æ•°æ®å·²ä¿å­˜ï¼æ€»åˆ†: ${total}ï¼Œå·²ä¿å­˜${learningData.length}æ¡è®°å½•`);
                }
            }
            
            // æ¸…ç©ºè¡¨å•
            clearForm();
            
            // ä¿å­˜æ•°æ®å¹¶æ›´æ–°æ˜¾ç¤º
            saveLocalData();
            displayLearningRecords();
        }
        
        function clearForm() {
            document.getElementById('study-time').value = '';
            document.getElementById('vocab-score').value = '';
            document.getElementById('listening-score').value = '';
            document.getElementById('reading-score').value = '';
            document.getElementById('writing-score').value = '';
            document.getElementById('external-score').value = '';
            document.getElementById('error-types').value = '';
            currentEditingIndex = -1; // é‡ç½®ç¼–è¾‘çŠ¶æ€
        }
        
        function displayLearningRecords() {
            const container = document.getElementById('records-container');
            
            if (learningData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div>ğŸ“Š</div>
                        <h3>æš‚æ— å­¦ä¹ è®°å½•</h3>
                        <p>è¯·åœ¨ä¸Šæ–¹è¡¨å•ä¸­æ·»åŠ æ‚¨çš„ç¬¬ä¸€æ¡å­¦ä¹ è®°å½•</p>
                    </div>
                `;
                return;
            }
            
            // æŒ‰æ—¥æœŸé™åºæ’åº
            const sortedData = [...learningData].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th>
                            <th>å­¦ä¹ æ—¶é—´(åˆ†é’Ÿ)</th>
                            <th>æ€»åˆ†</th>
                            <th>ä¸»è¦é”™è¯¯</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            sortedData.forEach((data, index) => {
                const totalScore = parseInt(data.vocabScore || 0) + 
                                  parseInt(data.listeningScore || 0) + 
                                  parseInt(data.readingScore || 0) + 
                                  parseInt(data.writingScore || 0) + 
                                  parseInt(data.externalScore || 0);
                
                // è½¬æ¢é”™è¯¯ç±»å‹ä¸ºä¸­æ–‡æ˜¾ç¤º
                let errorTypeText = "æ— ";
                switch(data.errorType) {
                    case "vocabulary": errorTypeText = "è¯æ±‡ä¸è¶³"; break;
                    case "grammar": errorTypeText = "è¯­æ³•é”™è¯¯"; break;
                    case "comprehension": errorTypeText = "ç†è§£åå·®"; break;
                    case "time": errorTypeText = "æ—¶é—´ä¸è¶³"; break;
                    case "focus": errorTypeText = "æ³¨æ„åŠ›ä¸é›†ä¸­"; break;
                }
                
                html += `
                    <tr>
                        <td>${data.date}</td>
                        <td>${data.studyTime || 0}</td>
                        <td class="points">${totalScore}</td>
                        <td>${errorTypeText}</td>
                        <td class="record-actions">
                            <button class="btn btn-small" onclick="editRecord(${index})">ç¼–è¾‘</button>
                            <button class="btn btn-small btn-danger" onclick="deleteRecord(${index})">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <p style="margin-top: 15px; color: var(--text-light);">å…± ${learningData.length} æ¡è®°å½•</p>
            `;
            
            container.innerHTML = html;
        }
        
        function editRecord(index) {
            const data = learningData[index];
            currentEditingIndex = index;
            
            // å¡«å……è¡¨å•
            document.getElementById('learning-date').value = data.date;
            document.getElementById('study-time').value = data.studyTime || '';
            document.getElementById('vocab-score').value = data.vocabScore || '';
            document.getElementById('listening-score').value = data.listeningScore || '';
            document.getElementById('reading-score').value = data.readingScore || '';
            document.getElementById('writing-score').value = data.writingScore || '';
            document.getElementById('external-score').value = data.externalScore || '';
            document.getElementById('error-types').value = data.errorType || '';
            
            // æ»šåŠ¨åˆ°è¡¨å•é¡¶éƒ¨
            document.querySelector('.data-form').scrollIntoView({ behavior: 'smooth' });
        }
        
        function deleteRecord(index) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ ${learningData[index].date} çš„è®°å½•å—ï¼Ÿ`)) {
                learningData.splice(index, 1);
                saveLocalData();
                displayLearningRecords();
                alert('è®°å½•å·²åˆ é™¤');
            }
        }
        
        function filterRecords() {
            const searchTerm = document.getElementById('record-search').value.toLowerCase();
            
            if (!searchTerm) {
                displayLearningRecords();
                return;
            }
            
            const filteredData = learningData.filter(data => {
                // è½¬æ¢é”™è¯¯ç±»å‹ä¸ºä¸­æ–‡ä»¥ä¾¿æœç´¢
                let errorTypeText = "";
                switch(data.errorType) {
                    case "vocabulary": errorTypeText = "è¯æ±‡ä¸è¶³"; break;
                    case "grammar": errorTypeText = "è¯­æ³•é”™è¯¯"; break;
                    case "comprehension": errorTypeText = "ç†è§£åå·®"; break;
                    case "time": errorTypeText = "æ—¶é—´ä¸è¶³"; break;
                    case "focus": errorTypeText = "æ³¨æ„åŠ›ä¸é›†ä¸­"; break;
                }
                
                return data.date.toLowerCase().includes(searchTerm) || 
                       errorTypeText.toLowerCase().includes(searchTerm);
            });
            
            const container = document.getElementById('records-container');
            
            if (filteredData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div>ğŸ”</div>
                        <h3>æœªæ‰¾åˆ°åŒ¹é…è®°å½•</h3>
                        <p>è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th>
                            <th>å­¦ä¹ æ—¶é—´(åˆ†é’Ÿ)</th>
                            <th>æ€»åˆ†</th>
                            <th>ä¸»è¦é”™è¯¯</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredData.forEach((data, index) => {
                // æ‰¾åˆ°åŸå§‹ç´¢å¼•
                const originalIndex = learningData.findIndex(item => item.date === data.date);
                if (originalIndex === -1) return;
                
                const totalScore = parseInt(data.vocabScore || 0) + 
                                  parseInt(data.listeningScore || 0) + 
                                  parseInt(data.readingScore || 0) + 
                                  parseInt(data.writingScore || 0) + 
                                  parseInt(data.externalScore || 0);
                
                // è½¬æ¢é”™è¯¯ç±»å‹ä¸ºä¸­æ–‡æ˜¾ç¤º
                let errorTypeText = "æ— ";
                switch(data.errorType) {
                    case "vocabulary": errorTypeText = "è¯æ±‡ä¸è¶³"; break;
                    case "grammar": errorTypeText = "è¯­æ³•é”™è¯¯"; break;
                    case "comprehension": errorTypeText = "ç†è§£åå·®"; break;
                    case "time": errorTypeText = "æ—¶é—´ä¸è¶³"; break;
                    case "focus": errorTypeText = "æ³¨æ„åŠ›ä¸é›†ä¸­"; break;
                }
                
                html += `
                    <tr>
                        <td>${data.date}</td>
                        <td>${data.studyTime || 0}</td>
                        <td class="points">${totalScore}</td>
                        <td>${errorTypeText}</td>
                        <td class="record-actions">
                            <button class="btn btn-small" onclick="editRecord(${originalIndex})">ç¼–è¾‘</button>
                            <button class="btn btn-small btn-danger" onclick="deleteRecord(${originalIndex})">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <p style="margin-top: 15px; color: var(--text-light);">æ‰¾åˆ° ${filteredData.length} æ¡åŒ¹é…è®°å½•</p>
            `;
            
            container.innerHTML = html;
        }
        
        function showAllRecords() {
            document.getElementById('record-search').value = '';
            displayLearningRecords();
        }
        
        // è®¡ç®—æ‰€æœ‰ç»Ÿè®¡æ•°æ®
        function calculateAllStats() {
            if (learningData.length === 0) {
                clearAllStats();
                return;
            }
            
            // è·å–å½“å‰æ—¥æœŸ
            const today = getBeijingDate();
            
            // è®¡ç®—æœ¬å‘¨æ•°æ®
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay() + (today.getDay() === 0 ? -6 : 1)); // å‘¨ä¸€
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6); // å‘¨æ—¥
            
            const weeklyData = learningData.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= weekStart && itemDate <= weekEnd;
            });
            
            calculatePeriodStats(weeklyData, 'weekly', formatDate(weekStart), formatDate(weekEnd));
            
            // è®¡ç®—æœ¬æœˆæ•°æ®
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            const monthlyData = learningData.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= monthStart && itemDate <= monthEnd;
            });
            
            calculatePeriodStats(monthlyData, 'monthly', formatDate(monthStart), formatDate(monthEnd));
            
            // è®¡ç®—æ•´ä½“æ•°æ®
            if (learningData.length > 0) {
                const firstDate = new Date(learningData.reduce((a, b) => new Date(a.date) < new Date(b.date) ? a : b).date);
                const lastDate = new Date(learningData.reduce((a, b) => new Date(a.date) > new Date(b.date) ? a : b).date);
                
                calculatePeriodStats(learningData, 'overall', formatDate(firstDate), formatDate(lastDate));
                
                // æ•´ä½“ç»Ÿè®¡ç‰¹æœ‰æ•°æ®
                document.getElementById('overall-days').textContent = learningData.length;
                
                // è®¡ç®—è¾¾æˆç‡ï¼ˆè¾¾åˆ°80åˆ†çš„æ¯”ä¾‹ï¼‰
                const targetDays = learningData.filter(data => {
                    const dailyScore = parseInt(data.vocabScore || 0) + 
                                      parseInt(data.listeningScore || 0) + 
                                      parseInt(data.readingScore || 0) + 
                                      parseInt(data.writingScore || 0) + 
                                      parseInt(data.externalScore || 0);
                    return dailyScore >= 80;
                }).length;
                
                const achievement = Math.round((targetDays / learningData.length) * 100);
                document.getElementById('overall-achievement').textContent = achievement + '%';
            }
        }
        
        // æ¸…é™¤æ‰€æœ‰ç»Ÿè®¡æ•°æ®
        function clearAllStats() {
            ['weekly', 'monthly', 'overall'].forEach(period => {
                document.getElementById(`${period}-avg-score`).textContent = '0';
                document.getElementById(`${period}-strongest`).textContent = '--';
                document.getElementById(`${period}-weakest`).textContent = '--';
                document.getElementById(`${period}-avg-time`).textContent = '0';
                document.getElementById(`${period}-period`).textContent = '-- è‡³ --';
                document.getElementById(`${period}-errors`).textContent = 'æš‚æ— æ•°æ®';
                document.getElementById(`${period}-chart`).innerHTML = '<div>æš‚æ— æ•°æ®</div>';
            });
            document.getElementById('overall-days').textContent = '0';
            document.getElementById('overall-achievement').textContent = '0%';
        }
        
        // è®¡ç®—æŒ‡å®šæ—¶é—´æ®µçš„ç»Ÿè®¡æ•°æ®
        function calculatePeriodStats(data, prefix, startDate, endDate) {
            if (data.length === 0) {
                document.getElementById(`${prefix}-avg-score`).textContent = '0';
                document.getElementById(`${prefix}-strongest`).textContent = '--';
                document.getElementById(`${prefix}-weakest`).textContent = '--';
                document.getElementById(`${prefix}-avg-time`).textContent = '0';
                document.getElementById(`${prefix}-period`).textContent = `${startDate} è‡³ ${endDate}`;
                document.getElementById(`${prefix}-errors`).textContent = 'æš‚æ— æ•°æ®';
                document.getElementById(`${prefix}-chart`).innerHTML = '<div>æš‚æ— æ•°æ®</div>';
                return;
            }
            
            // è®¾ç½®æ—¶é—´æ®µ
            document.getElementById(`${prefix}-period`).textContent = `${startDate} è‡³ ${endDate}`;
            
            // è®¡ç®—å¹³å‡åˆ†
            let totalScore = 0;
            data.forEach(item => {
                const dailyScore = parseInt(item.vocabScore || 0) + 
                                  parseInt(item.listeningScore || 0) + 
                                  parseInt(item.readingScore || 0) + 
                                  parseInt(item.writingScore || 0) + 
                                  parseInt(item.externalScore || 0);
                totalScore += dailyScore;
            });
            
            const avgScore = Math.round(totalScore / data.length);
            document.getElementById(`${prefix}-avg-score`).textContent = avgScore;
            
            // è®¡ç®—å„æŠ€èƒ½å¹³å‡åˆ†ä»¥ç¡®å®šæœ€å¼ºå’Œæœ€å¼±é¡¹
            let vocabTotal = 0, listeningTotal = 0, readingTotal = 0, writingTotal = 0, externalTotal = 0;
            let studyTimeTotal = 0;
            const errorTypes = {};
            
            data.forEach(item => {
                vocabTotal += parseInt(item.vocabScore || 0);
                listeningTotal += parseInt(item.listeningScore || 0);
                readingTotal += parseInt(item.readingScore || 0);
                writingTotal += parseInt(item.writingScore || 0);
                externalTotal += parseInt(item.externalScore || 0);
                studyTimeTotal += parseInt(item.studyTime || 0);
                
                // ç»Ÿè®¡é”™è¯¯ç±»å‹
                if (item.errorType) {
                    errorTypes[item.errorType] = (errorTypes[item.errorType] || 0) + 1;
                }
            });
            
            const count = data.length;
            const avgVocab = Math.round(vocabTotal / count);
            const avgListening = Math.round(listeningTotal / count);
            const avgReading = Math.round(readingTotal / count);
            const avgWriting = Math.round(writingTotal / count);
            
            const skills = [
                { name: "è¯æ±‡", score: avgVocab },
                { name: "å¬åŠ›", score: avgListening },
                { name: "é˜…è¯»", score: avgReading },
                { name: "å†™ä½œ", score: avgWriting }
            ];
            
            // æ’åºæ‰¾å‡ºæœ€å¼ºå’Œæœ€å¼±é¡¹
            skills.sort((a, b) => b.score - a.score);
            document.getElementById(`${prefix}-strongest`).textContent = `${skills[0].name} (${skills[0].score})`;
            document.getElementById(`${prefix}-weakest`).textContent = `${skills[skills.length - 1].name} (${skills[skills.length - 1].score})`;
            
            // å¹³å‡å­¦ä¹ æ—¶é—´
            const avgStudyTime = Math.round(studyTimeTotal / count);
            document.getElementById(`${prefix}-avg-time`).textContent = avgStudyTime;
            
            // é”™è¯¯ç±»å‹åˆ†æ
            if (Object.keys(errorTypes).length > 0) {
                let errorText = "";
                const sortedErrors = Object.entries(errorTypes).sort((a, b) => b[1] - a[1]);
                
                sortedErrors.forEach(([type, count], index) => {
                    let typeText = "";
                    switch(type) {
                        case "vocabulary": typeText = "è¯æ±‡ä¸è¶³"; break;
                        case "grammar": typeText = "è¯­æ³•é”™è¯¯"; break;
                        case "comprehension": typeText = "ç†è§£åå·®"; break;
                        case "time": typeText = "æ—¶é—´ä¸è¶³"; break;
                        case "focus": typeText = "æ³¨æ„åŠ›ä¸é›†ä¸­"; break;
                    }
                    
                    errorText += `${typeText}: ${count}æ¬¡`;
                    if (index < sortedErrors.length - 1) errorText += "ï¼Œ";
                });
                
                document.getElementById(`${prefix}-errors`).textContent = errorText;
            } else {
                document.getElementById(`${prefix}-errors`).textContent = "æœªè®°å½•é”™è¯¯ç±»å‹";
            }
            
            // ç”Ÿæˆå›¾è¡¨
            generateScoreChart(data, `${prefix}-chart`);
        }
        
        // ç”Ÿæˆåˆ†æ•°å›¾è¡¨
        function generateScoreChart(data, chartId) {
            const chartContainer = document.getElementById(chartId);
            chartContainer.innerHTML = '';
            
            // æŒ‰æ—¥æœŸæ’åº
            const sortedData = [...data].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // è®¡ç®—æœ€é«˜åˆ†ç”¨äºæ¯”ä¾‹ç¼©æ”¾
            let maxScore = 0;
            sortedData.forEach(item => {
                const score = parseInt(item.vocabScore || 0) + 
                             parseInt(item.listeningScore || 0) + 
                             parseInt(item.readingScore || 0) + 
                             parseInt(item.writingScore || 0) + 
                             parseInt(item.externalScore || 0);
                if (score > maxScore) maxScore = score;
            });
            
            // ç¡®ä¿æœ‰ä¸€ä¸ªåˆç†çš„æœ€å¤§å€¼
            maxScore = Math.max(maxScore, 100);
            
            // åˆ›å»ºæŸ±çŠ¶å›¾
            sortedData.forEach(item => {
                const score = parseInt(item.vocabScore || 0) + 
                             parseInt(item.listeningScore || 0) + 
                             parseInt(item.readingScore || 0) + 
                             parseInt(item.writingScore || 0) + 
                             parseInt(item.externalScore || 0);
                
                // è®¡ç®—é«˜åº¦æ¯”ä¾‹ (æœ€é«˜åˆ†ä¸º100%é«˜åº¦)
                const height = (score / maxScore) * 100;
                
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${height}%`;
                bar.style.bottom = '0';
                
                // æ·»åŠ åˆ†æ•°æ ‡ç­¾
                const scoreLabel = document.createElement('div');
                scoreLabel.style.position = 'absolute';
                scoreLabel.style.top = '-20px';
                scoreLabel.style.left = '50%';
                scoreLabel.style.transform = 'translateX(-50%)';
                scoreLabel.style.fontSize = '12px';
                scoreLabel.textContent = score;
                bar.appendChild(scoreLabel);
                
                // æ·»åŠ æ—¥æœŸæ ‡ç­¾
                const dateLabel = document.createElement('div');
                dateLabel.className = 'chart-label';
                // åªæ˜¾ç¤ºæœˆ/æ—¥
                const date = new Date(item.date);
                dateLabel.textContent = `${date.getMonth() + 1}/${date.getDate()}`;
                bar.appendChild(dateLabel);
                
                chartContainer.appendChild(bar);
            });
        }
        
        function updateAvailableRewards() {
            const rewardsElement = document.getElementById('available-rewards');
            if (totalPoints >= 80) {
                rewardsElement.innerHTML = '<span style="color:green;">âœ“ æ­å–œï¼æ‚¨å·²è·å¾—ä»Šæ—¥å¥–åŠ±ï¼š30åˆ†é’Ÿæ— è´Ÿç½ªæ„Ÿå¨±ä¹æ—¶é—´</span>';
            } else {
                rewardsElement.textContent = `è¿˜éœ€${80 - totalPoints}åˆ†æ‰èƒ½è§£é”ä»Šæ—¥å¥–åŠ±`;
            }
        }
        
        function claimReward() {
            if (totalPoints >= 80) {
                alert('å¥–åŠ±å·²é¢†å–ï¼äº«å—æ‚¨çš„30åˆ†é’Ÿå¨±ä¹æ—¶é—´å§ï¼');
            } else {
                alert(`å°šæœªè¾¾åˆ°å…‘æ¢è¦æ±‚ï¼Œè¿˜éœ€${80 - totalPoints}åˆ†`);
            }
        }
        
        // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
        document.querySelectorAll('.nav-tab, .btn, .checkbox, .stats-tab').forEach(element => {
            element.addEventListener('touchstart', function() {
                this.style.opacity = '0.7';
            });
            
            element.addEventListener('touchend', function() {
                this.style.opacity = '1';
            });
        });
        
        // é˜²æ­¢iOSç¼©æ”¾
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>